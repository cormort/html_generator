<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML 產生器 (增強版)</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/material.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/dracula.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/lint/lint.css">

    <style>
        /* 3. 使用 CSS 變數定義預設淺色主題 (Default Light) */
        :root {
            --bg-color: #f8f9fa;
            --text-color: #343a40;
            --container-bg: #ffffff;
            --container-shadow: rgba(0, 0, 0, 0.08);
            --heading-color: #2c3e50;
            --button-primary-bg: #4a6785;
            --button-primary-hover: #3a536b;
            --button-check-bg: #28a745;
            --button-check-hover: #218838;
            --button-danger-bg: #dc3545;
            --button-danger-hover: #c82333;
            --cm-border-color: #ced4da;
            --cm-focus-border: #8ab4f8;
            --cm-focus-shadow: rgba(74, 103, 133, 0.25);
            --selector-bg: #ffffff;
            --selector-border: #ced4da;
        }

        /* (新增) Material 深色主題 */
        [data-theme="material"] {
            --bg-color: #263238;
            --text-color: #ECEFF1;
            --container-bg: #37474F;
            --container-shadow: rgba(0, 0, 0, 0.25);
            --heading-color: #ffffff;
            --button-primary-bg: #009688;
            --button-primary-hover: #00796B;
            --button-check-bg: #4CAF50;
            --button-check-hover: #43A047;
            --button-danger-bg: #f44336;
            --button-danger-hover: #e53935;
            --cm-border-color: #546E7A;
            --cm-focus-border: #80CBC4;
            --cm-focus-shadow: rgba(128, 203, 196, 0.25);
            --selector-bg: #546E7A;
            --selector-border: #546E7A;
        }

        /* (新增) Dracula 深色主題 */
        [data-theme="dracula"] {
            --bg-color: #282a36;
            --text-color: #f8f8f2;
            --container-bg: #3b3d50;
            --container-shadow: rgba(0, 0, 0, 0.25);
            --heading-color: #bd93f9; /* purple */
            --button-primary-bg: #bd93f9;
            --button-primary-hover: #a47de4;
            --button-check-bg: #50fa7b; /* green */
            --button-check-hover: #42e368;
            --button-danger-bg: #ff5555; /* red */
            --button-danger-hover: #ff2d2d;
            --cm-border-color: #6272a4;
            --cm-focus-border: #bd93f9;
            --cm-focus-shadow: rgba(189, 147, 249, 0.25);
            --selector-bg: #6272a4;
            --selector-border: #6272a4;
        }


        /* 4. 將現有樣式改為使用 CSS 變數 */
        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', 'PingFang TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s; /* 增加過場動畫 */
        }

        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 30px;
            background-color: var(--container-bg);
            border-radius: 8px;
            box-shadow: 0 4px 12px var(--container-shadow);
            transition: background-color 0.3s;
        }

        h1, p { text-align: center; }
        h1 { color: var(--heading-color); }
        p { margin-bottom: 1.5em; }

        /* (新增) 主題選擇器樣式 */
        .theme-selector-container {
            text-align: right;
            margin-bottom: 15px;
        }
        #theme-select {
            padding: 5px 8px;
            border-radius: 4px;
            border: 1px solid var(--selector-border);
            background-color: var(--selector-bg);
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .CodeMirror {
            border: 1px solid var(--cm-border-color);
            border-radius: 6px;
            height: 400px;
            font-size: 1rem;
            margin-bottom: 15px;
        }
        .CodeMirror:focus-within {
             border-color: var(--cm-focus-border);
             box-shadow: 0 0 0 0.2rem var(--cm-focus-shadow);
        }

        .button-container { text-align: center; }

        button {
            padding: 12px 22px;
            font-size: 1rem;
            cursor: pointer;
            margin: 5px;
            border: none;
            border-radius: 6px;
            color: white;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease;
        }
        
        button:not(#clearButton):not(#checkButton) {
            background-color: var(--button-primary-bg);
        }
        button:not(#clearButton):not(#checkButton):hover {
            background-color: var(--button-primary-hover);
            transform: translateY(-1px);
        }
        
        #checkButton {
            background-color: var(--button-check-bg);
        }
        #checkButton:hover {
            background-color: var(--button-check-hover);
            transform: translateY(-1px);
        }

        #clearButton {
            background-color: var(--button-danger-bg);
        }
        #clearButton:hover {
            background-color: var(--button-danger-hover);
            transform: translateY(-1px);
        }

        button:active { transform: translateY(0px); }
    </style>
</head>
<body>

    <div class="container">
        <h1>HTML 原始碼產生器 (增強版)</h1>
        <p>請在下方的編輯器中貼上您的 HTML 原始碼，程式碼會自動高亮。點擊按鈕進行檢查、預覽或下載。</p>

        <div class="theme-selector-container">
            <label for="theme-select">選擇主題: </label>
            <select id="theme-select" onchange="applyTheme(this.value)">
                <option value="default-light">預設淺色 (Default Light)</option>
                <option value="material">Material (Dark)</option>
                <option value="dracula">Dracula (Dark)</option>
            </select>
        </div>

        <textarea id="htmlSource" placeholder="在這裡貼上您的 HTML 原始碼..."></textarea>
        
        <div class="button-container">
            <button type="button" id="checkButton" onclick="checkSyntax()">檢查語法</button>
            <button type="button" onclick="previewHTML()">預覽 HTML</button>
            <button type="button" onclick="downloadHTML()">下載 HTML</button>
            <button type="button" id="clearButton" onclick="clearContent()">清除內容</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jshint/2.13.6/jshint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/lint/javascript-lint.js"></script>
    <script src="https://unpkg.com/htmlhint@latest/lib/htmlhint.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/lint/html-lint.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/lint/lint.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/htmlmixed/htmlmixed.min.js"></script>

    <script>
        // 6. (修改) 初始化 CodeMirror 編輯器
        var editor = CodeMirror.fromTextArea(document.getElementById('htmlSource'), {
            mode: "htmlmixed",
            theme: "default", // 7. (修改) 預設主題改為 'default' (淺色)
            lineNumbers: true,
            lineWrapping: true,
            gutters: ["CodeMirror-lint-markers"],
            lint: true
        });

        // 8. (新增) 切換主題的函式
        function applyTheme(themeName) {
            let cmTheme = 'default'; // CodeMirror 的主題名稱

            if (themeName === 'default-light') {
                // 移除 data-theme 屬性以使用 :root 的預設值
                document.body.removeAttribute('data-theme');
                cmTheme = 'default';
            } else {
                // 'material' 或 'dracula'
                document.body.dataset.theme = themeName;
                cmTheme = themeName; 
            }
            
            // 設定 CodeMirror 編輯器的主題
            editor.setOption('theme', cmTheme);
        }


        // (以下函式不變，僅修改為從 editor 獲取/設定內容)

        function checkSyntax() {
            editor.performLint();
            alert("語法檢查已執行完畢！請查看編輯器左側的錯誤標記（如果有的話）。");
        }

        function previewHTML() {
            var htmlContent = editor.getValue();
            var newWindow = window.open();
            if (newWindow) {
                newWindow.document.write(htmlContent);
                newWindow.document.close();
            } else {
                alert("請允許彈出式視窗以預覽內容。");
            }
        }

        function downloadHTML() {
            var htmlContent = editor.getValue();
            var blob = new Blob([htmlContent], { type: 'text/html' });
            var a = document.createElement('a');
            a.style.display = 'none';
            var url = window.URL.createObjectURL(blob);
            a.href = url;
            a.download = 'generated.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function clearContent() {
            editor.setValue('');
        }
    </script>

</body>
</html>
